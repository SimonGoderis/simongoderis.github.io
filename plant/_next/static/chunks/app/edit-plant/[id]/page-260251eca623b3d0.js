(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{5917:function(e,t,r){Promise.resolve().then(r.bind(r,5814))},5814:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return EditPlantClient}});var a=r(7437),n=r(2265),l=r(4033),i=r(4034),s=r(7630),o=r(5925);function EditPlantClient(e){let{id:t}=e,[r,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(!0),[m,g]=(0,n.useState)(!1),f=(0,l.useRouter)();(0,n.useEffect)(()=>{let fetchPlant=async()=>{try{let e=await (0,i.JA)(t);c(e)}catch(e){console.error("Error fetching plant:",e),o.default.error("Failed to load plant"),f.push("/")}finally{u(!1)}};fetchPlant()},[t,f]);let handleSubmit=async e=>{try{g(!0);let r={name:e.get("name"),species:e.get("species"),watering_frequency:parseInt(e.get("watering_frequency")),sunlight_requirement:e.get("sunlight_requirement"),notes:e.get("notes")},a=e.get("image");a instanceof File&&a.size>0?await (0,i.Vn)(t,r,a):await (0,i.Vn)(t,r),o.default.success("Plant updated successfully"),f.push("/")}catch(e){console.error("Error updating plant:",e),o.default.error("Failed to update plant")}finally{g(!1)}};return d?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):r?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:["Edit Plant: ",r.name]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,a.jsx)(s.Z,{plant:r,onSubmit:handleSubmit,onCancel:()=>{f.push("/")}})})]}):null}},7630:function(e,t,r){"use strict";r.d(t,{Z:function(){return PlantForm}});var a=r(7437),n=r(2265),l=r(6691),i=r.n(l);function PlantForm(e){var t;let{plant:r,onSubmit:l,onCancel:s}=e,[o,c]=(0,n.useState)((null==r?void 0:r.name)||""),[d,u]=(0,n.useState)((null==r?void 0:r.species)||""),[m,g]=(0,n.useState)((null==r?void 0:null===(t=r.watering_frequency)||void 0===t?void 0:t.toString())||"7"),[f,p]=(0,n.useState)((null==r?void 0:r.sunlight_requirement)||"Medium"),[h,w]=(0,n.useState)((null==r?void 0:r.notes)||""),[x,b]=(0,n.useState)((null==r?void 0:r.image_url)||null),[y,v]=(0,n.useState)(null);return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData;t.append("name",o),t.append("species",d),t.append("watering_frequency",m),t.append("sunlight_requirement",f),t.append("notes",h),y&&t.append("image",y),(null==r?void 0:r.id)&&t.append("id",r.id),l(t)},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Plant Name *"}),(0,a.jsx)("input",{type:"text",id:"name",value:o,onChange:e=>c(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"species",className:"block text-sm font-medium text-gray-700",children:"Species"}),(0,a.jsx)("input",{type:"text",id:"species",value:d,onChange:e=>u(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"watering_frequency",className:"block text-sm font-medium text-gray-700",children:"Watering Frequency (days) *"}),(0,a.jsx)("input",{type:"number",id:"watering_frequency",value:m,onChange:e=>g(e.target.value),min:"1",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"sunlight_requirement",className:"block text-sm font-medium text-gray-700",children:"Sunlight Requirement"}),(0,a.jsxs)("select",{id:"sunlight_requirement",value:f,onChange:e=>p(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[(0,a.jsx)("option",{value:"Low",children:"Low"}),(0,a.jsx)("option",{value:"Medium",children:"Medium"}),(0,a.jsx)("option",{value:"High",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{id:"notes",value:h,onChange:e=>w(e.target.value),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700",children:"Plant Image"}),(0,a.jsx)("input",{type:"file",id:"image",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];v(t);let r=new FileReader;r.onload=e=>{var t;b(null===(t=e.target)||void 0===t?void 0:t.result)},r.readAsDataURL(t)}},className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"})]}),x&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Image Preview:"}),(0,a.jsx)("div",{className:"relative h-48 w-full",children:(0,a.jsx)(i(),{src:x,alt:"Plant preview",fill:!0,className:"object-cover rounded-md"})})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700",children:r?"Update Plant":"Add Plant"})]})]})}},4034:function(e,t,r){"use strict";r.d(t,{YQ:function(){return addWateringRecords},xm:function(){return archivePlant},aE:function(){return createPlant},dr:function(){return deletePlant},JA:function(){return getPlant},sX:function(){return getPlants},WL:function(){return getWateringRecords},Vn:function(){return updatePlant}});var a=r(4566);let n=(0,a.eI)("https://xorjulfvnkcmsroavihv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhvcmp1bGZ2bmtjbXNyb2F2aWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMzMzMDQsImV4cCI6MjA1NzcwOTMwNH0.sxhrNSIfmbZXACOysArKUx2g8bUTees8tojRgKAmAp4");var l=r(3743),i=r(2536);async function compressImage(e){try{let t=await (0,i.Z)(e,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});return new File([t],e.name,{type:t.type})}catch(t){return console.error("Error compressing image:",t),e}}async function getPlants(){let{data:e,error:t}=await n.from("plants").select("*").eq("archived",!1).order("name");if(t)throw console.error("Error fetching plants:",t),t;let{data:r,error:a}=await n.from("watering_records").select("*");if(a)throw console.error("Error fetching watering records:",a),a;return e.map(e=>{let t=r.filter(t=>t.plant_id===e.id);if(0===t.length)return{...e,days_until_watering:0,last_watered:null};let a=t.reduce((e,t)=>new Date(e.date)>new Date(t.date)?e:t),n=new Date(a.date),i=(0,l.Z)(new Date,n),s=e.watering_frequency-i;return{...e,days_until_watering:s,last_watered:a.date}})}async function getPlant(e){let{data:t,error:r}=await n.from("plants").select("*").eq("id",e).single();if(r)throw console.error("Error fetching plant:",r),r;return t}async function createPlant(e,t){let r=null;if(t)try{let e=await compressImage(t),a=new Date().getTime(),l=t.name.split(".").pop(),i="".concat(a,"_").concat(Math.random().toString(36).substring(7),".").concat(l),{data:s,error:o}=await n.storage.from("plant-image").upload(i,e,{contentType:e.type});if(o)throw console.error("Error uploading image:",o),o;let{data:{publicUrl:c}}=n.storage.from("plant-image").getPublicUrl(i);r=c}catch(e){throw console.error("Error processing image upload:",e),e}let{data:a,error:l}=await n.from("plants").insert([{...e,image_url:r,archived:!1}]).select().single();if(l)throw console.error("Error creating plant:",l),l;return a}async function updatePlant(e,t,r){let a={...t};if(r)try{let e=await compressImage(r),l=new Date().getTime(),i=r.name.split(".").pop(),s="".concat(l,"_").concat(Math.random().toString(36).substring(7),".").concat(i);if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove([e])}let{data:o,error:c}=await n.storage.from("plant-image").upload(s,e,{contentType:e.type});if(c)throw console.error("Error uploading image:",c),c;let{data:{publicUrl:d}}=n.storage.from("plant-image").getPublicUrl(s);a.image_url=d}catch(e){throw console.error("Error processing image upload:",e),e}let{data:l,error:i}=await n.from("plants").update(a).eq("id",e).select().single();if(i)throw console.error("Error updating plant:",i),i;return l}async function archivePlant(e){let{error:t}=await n.from("plants").update({archived:!0}).eq("id",e);if(t)throw console.error("Error archiving plant:",t),t}async function deletePlant(e){let{data:t,error:r}=await n.from("plants").select("image_url").eq("id",e).single();if(r)throw console.error("Error fetching plant for deletion:",r),r;let{error:a}=await n.from("watering_records").delete().eq("plant_id",e);if(a)throw console.error("Error deleting watering records:",a),a;let{error:l}=await n.from("plants").delete().eq("id",e);if(l)throw console.error("Error deleting plant:",l),l;if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove(["plant-image/".concat(e)])}}async function getWateringRecords(e){let{data:t,error:r}=await n.from("watering_records").select("*").eq("plant_id",e).order("date",{ascending:!1});if(r)throw console.error("Error fetching watering records:",r),r;return t}async function addWateringRecords(e){let{error:t}=await n.from("watering_records").insert(e);if(t)throw console.error("Error adding watering records:",t),t}}},function(e){e.O(0,[332,971,472,744],function(){return e(e.s=5917)}),_N_E=e.O()}]);