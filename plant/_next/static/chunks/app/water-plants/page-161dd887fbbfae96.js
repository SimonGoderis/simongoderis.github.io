(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[390],{4132:function(e,t,r){Promise.resolve().then(r.bind(r,63))},63:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return WaterPlants}});var a=r(7437),n=r(2265),o=r(4033),l=r(4034),i=r(6691),s=r.n(i),c=r(5925);function WaterPlants(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(!0),[d,g]=(0,n.useState)(new Set),[u,m]=(0,n.useState)({}),f=(0,o.useRouter)();(0,n.useEffect)(()=>{fetchPlants()},[]);let fetchPlants=async()=>{try{i(!0);let e=await (0,l.sX)();t(e)}catch(e){console.error("Error fetching plants:",e),c.default.error("Failed to load plants")}finally{i(!1)}},togglePlantSelection=e=>{let t=new Set(d);if(t.has(e)){t.delete(e);let r={...u};delete r[e],m(r)}else t.add(e);g(t)},handleSubmit=async()=>{if(0===d.size){c.default.error("Please select at least one plant to water");return}try{let e=Array.from(d).map(e=>({plant_id:e,date:new Date().toISOString(),notes:u[e]||null}));await (0,l.YQ)(e),c.default.success("Watering records added successfully"),f.push("/")}catch(e){console.error("Error adding watering records:",e),c.default.error("Failed to add watering records")}},getWateringStatusColor=e=>e<=0?"bg-red-100 text-red-800":e<=2?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return r?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,a.jsxs)("div",{className:"min-h-screen pb-20",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Water Plants"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Select the plants you want to water"})]}),e.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:e.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden cursor-pointer transition-transform transform hover:scale-[1.02] ".concat(d.has(e.id)?"ring-2 ring-green-500":""),onClick:()=>togglePlantSelection(e.id),children:[(0,a.jsx)("div",{className:"relative h-48 w-full",children:e.image_url?(0,a.jsx)(s(),{src:e.image_url,alt:e.name,fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center bg-gray-200",children:(0,a.jsx)("span",{className:"text-gray-400",children:"No image"})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:e.name}),(0,a.jsx)("p",{className:"text-gray-600 italic",children:e.species}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-semibold ".concat(getWateringStatusColor(e.days_until_watering)),children:e.days_until_watering<=0?"Needs watering now!":"".concat(e.days_until_watering," days until next watering")})}),d.has(e.id)&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("label",{htmlFor:"notes-".concat(e.id),className:"block text-sm font-medium text-gray-700",children:"Watering Notes (optional)"}),(0,a.jsx)("textarea",{id:"notes-".concat(e.id),value:u[e.id]||"",onChange:t=>m({...u,[e.id]:t.target.value}),onClick:e=>e.stopPropagation(),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",rows:2})]})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No plants in your inventory yet."}),(0,a.jsx)("button",{onClick:()=>f.push("/add-plant"),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add Your First Plant"})]}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>f.push("/"),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:handleSubmit,disabled:0===d.size,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(0===d.size?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),children:"Record Watering"})]})})})]})}},4034:function(e,t,r){"use strict";r.d(t,{YQ:function(){return addWateringRecords},xm:function(){return archivePlant},aE:function(){return createPlant},dr:function(){return deletePlant},JA:function(){return getPlant},sX:function(){return getPlants},WL:function(){return getWateringRecords},Vn:function(){return updatePlant}});var a=r(4566);let n=(0,a.eI)("https://xorjulfvnkcmsroavihv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhvcmp1bGZ2bmtjbXNyb2F2aWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMzMzMDQsImV4cCI6MjA1NzcwOTMwNH0.sxhrNSIfmbZXACOysArKUx2g8bUTees8tojRgKAmAp4");var o=r(3743),l=r(2536);async function compressImage(e){try{let t=await (0,l.Z)(e,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});return new File([t],e.name,{type:t.type})}catch(t){return console.error("Error compressing image:",t),e}}async function getPlants(){let{data:e,error:t}=await n.from("plants").select("*").eq("archived",!1).order("name");if(t)throw console.error("Error fetching plants:",t),t;let{data:r,error:a}=await n.from("watering_records").select("*");if(a)throw console.error("Error fetching watering records:",a),a;return e.map(e=>{let t=r.filter(t=>t.plant_id===e.id);if(0===t.length)return{...e,days_until_watering:0,last_watered:null};let a=t.reduce((e,t)=>new Date(e.date)>new Date(t.date)?e:t),n=new Date(a.date),l=(0,o.Z)(new Date,n),i=e.watering_frequency-l;return{...e,days_until_watering:i,last_watered:a.date}})}async function getPlant(e){let{data:t,error:r}=await n.from("plants").select("*").eq("id",e).single();if(r)throw console.error("Error fetching plant:",r),r;return t}async function createPlant(e,t){let r=null;if(t)try{let e=await compressImage(t),a=new Date().getTime(),o=t.name.split(".").pop(),l="".concat(a,"_").concat(Math.random().toString(36).substring(7),".").concat(o),{data:i,error:s}=await n.storage.from("plant-image").upload(l,e,{contentType:e.type});if(s)throw console.error("Error uploading image:",s),s;let{data:{publicUrl:c}}=n.storage.from("plant-image").getPublicUrl(l);r=c}catch(e){throw console.error("Error processing image upload:",e),e}let{data:a,error:o}=await n.from("plants").insert([{...e,image_url:r,archived:!1}]).select().single();if(o)throw console.error("Error creating plant:",o),o;return a}async function updatePlant(e,t,r){let a={...t};if(r)try{let e=await compressImage(r),o=new Date().getTime(),l=r.name.split(".").pop(),i="".concat(o,"_").concat(Math.random().toString(36).substring(7),".").concat(l);if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove([e])}let{data:s,error:c}=await n.storage.from("plant-image").upload(i,e,{contentType:e.type});if(c)throw console.error("Error uploading image:",c),c;let{data:{publicUrl:d}}=n.storage.from("plant-image").getPublicUrl(i);a.image_url=d}catch(e){throw console.error("Error processing image upload:",e),e}let{data:o,error:l}=await n.from("plants").update(a).eq("id",e).select().single();if(l)throw console.error("Error updating plant:",l),l;return o}async function archivePlant(e){let{error:t}=await n.from("plants").update({archived:!0}).eq("id",e);if(t)throw console.error("Error archiving plant:",t),t}async function deletePlant(e){let{data:t,error:r}=await n.from("plants").select("image_url").eq("id",e).single();if(r)throw console.error("Error fetching plant for deletion:",r),r;let{error:a}=await n.from("watering_records").delete().eq("plant_id",e);if(a)throw console.error("Error deleting watering records:",a),a;let{error:o}=await n.from("plants").delete().eq("id",e);if(o)throw console.error("Error deleting plant:",o),o;if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove(["plant-image/".concat(e)])}}async function getWateringRecords(e){let{data:t,error:r}=await n.from("watering_records").select("*").eq("plant_id",e).order("date",{ascending:!1});if(r)throw console.error("Error fetching watering records:",r),r;return t}async function addWateringRecords(e){let{error:t}=await n.from("watering_records").insert(e);if(t)throw console.error("Error adding watering records:",t),t}}},function(e){e.O(0,[332,971,472,744],function(){return e(e.s=4132)}),_N_E=e.O()}]);