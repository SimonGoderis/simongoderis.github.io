(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6038:function(e,t,r){Promise.resolve().then(r.bind(r,6099))},6099:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Home}});var a=r(7437),n=r(2265),s=r(4033),l=r(4034),i=r(6691),c=r.n(i);function ConfirmationModal(e){let{isOpen:t,title:r,message:n,confirmLabel:s,cancelLabel:l,alternativeLabel:i,onConfirm:c,onCancel:o,onAlternative:d}=e;return t?(0,a.jsx)("div",{className:"modal",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsx)("div",{className:"modal-header",children:(0,a.jsx)("h3",{className:"text-lg font-semibold",children:r})}),(0,a.jsx)("div",{className:"modal-body",children:(0,a.jsx)("p",{className:"text-gray-600",children:n})}),(0,a.jsxs)("div",{className:"modal-footer",children:[(0,a.jsx)("button",{onClick:o,className:"button-secondary",children:l}),i&&d&&(0,a.jsx)("button",{onClick:d,className:"button-secondary bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",children:i}),(0,a.jsx)("button",{onClick:c,className:"button-primary",children:s})]})]})}):null}var o=r(9223),d=r(573);function WateringHistoryModal(e){let{plant:t,onClose:r}=e,[s,i]=(0,n.useState)([]),[c,m]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let fetchWateringHistory=async()=>{try{let e=await (0,l.WL)(t.id);i(e)}catch(e){console.error("Error fetching watering history:",e)}finally{m(!1)}};fetchWateringHistory()},[t.id]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsx)("h2",{className:"text-xl font-semibold",children:t.name})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:(0,a.jsx)("table",{className:"w-full",children:(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Name:"}),(0,a.jsx)("td",{children:t.name})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Species:"}),(0,a.jsx)("td",{children:t.species})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Sunlight:"}),(0,a.jsx)("td",{children:t.sunlight_requirement})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Watering Frequency:"}),(0,a.jsxs)("td",{children:["Every ",t.watering_frequency," days"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Last Watered:"}),(0,a.jsx)("td",{children:t.last_watered?(0,d.Z)(new Date(t.last_watered),{addSuffix:!0}):"Never"})]}),t.notes&&(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 font-medium",children:"Notes:"}),(0,a.jsx)("td",{className:"whitespace-pre-wrap",children:t.notes})]})]})})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Watering History"}),c?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):s.length>0?(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-2 px-4 text-left",children:"Date"}),(0,a.jsx)("th",{className:"py-2 px-4 text-left",children:"Time"}),(0,a.jsx)("th",{className:"py-2 px-4 text-left",children:"Notes"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 px-4",children:(0,o.ZP)(new Date(e.date),"MMM d, yyyy")}),(0,a.jsx)("td",{className:"py-2 px-4 text-gray-500",children:(0,o.ZP)(new Date(e.date),"h:mm a")}),(0,a.jsx)("td",{className:"py-2 px-4 text-gray-600",children:e.notes||"-"})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-center py-4 text-gray-500",children:"No watering records found."})]}),(0,a.jsx)("div",{className:"p-4 border-t flex justify-end",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Close"})})]})})}function PlantCard(e){let{plant:t,onEdit:r,onDelete:s,onArchive:l}=e,[i,o]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"plant-card cursor-pointer",onClick:()=>{h(!0)},children:[(0,a.jsxs)("div",{className:"relative h-48 w-full",children:[t.image_url?(0,a.jsx)(c(),{src:t.image_url,alt:t.name,fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center bg-gray-100",children:(0,a.jsx)("span",{className:"text-gray-400",children:"No image"})}),(0,a.jsx)("div",{className:"absolute top-3 right-3",children:(0,a.jsx)("div",{className:"water-indicator ".concat(t.days_until_watering<=0?"needs-water":""),children:(0,a.jsx)("span",{className:"text-sm font-medium",children:t.days_until_watering<=0?"!":t.days_until_watering})})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:t.species})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),(0,a.jsx)("span",{className:"text-sm",children:t.sunlight_requirement})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 21.5c-4.418 0-8-3.582-8-8 0-4.134 4-10.5 8-10.5s8 6.366 8 10.5c0 4.418-3.582 8-8 8zm0-2c3.314 0 6-2.686 6-6 0-2.969-3-8.5-6-8.5S6 10.531 6 13.5c0 3.314 2.686 6 6 6z"})}),(0,a.jsxs)("span",{className:"text-sm",children:["Every ",t.watering_frequency," days"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-auto pt-2 border-t",children:[t.last_watered&&(0,a.jsx)("div",{className:"px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-600",children:(0,d.Z)(new Date(t.last_watered),{addSuffix:!0})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),r(t.id)},className:"p-2 text-blue-600 hover:text-blue-800",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),o(!0)},className:"p-2 text-red-600 hover:text-red-800",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]}),(0,a.jsx)(ConfirmationModal,{isOpen:i,title:"Remove Plant",message:"Do you want to completely delete this plant or archive it? Archiving will keep all records but hide the plant from view.",confirmLabel:"Delete",cancelLabel:"Cancel",alternativeLabel:"Archive",onConfirm:()=>{s(t.id),o(!1)},onCancel:()=>o(!1),onAlternative:()=>{l(t.id),o(!1)}}),m&&(0,a.jsx)(WateringHistoryModal,{plant:t,onClose:()=>h(!1)})]})}var m=r(5925);function Home(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(!0),c=(0,s.useRouter)();(0,n.useEffect)(()=>{fetchPlants()},[]);let fetchPlants=async()=>{try{i(!0);let e=await (0,l.sX)();t(e)}catch(e){console.error("Error fetching plants:",e),m.default.error("Failed to load plants")}finally{i(!1)}},handleAddPlant=()=>{c.push("/add-plant")},handleEditPlant=e=>{c.push("/edit-plant/".concat(e))},handleDeletePlant=async e=>{try{await (0,l.dr)(e),m.default.success("Plant deleted successfully"),fetchPlants()}catch(e){console.error("Error deleting plant:",e),m.default.error("Failed to delete plant")}},handleArchivePlant=async e=>{try{await (0,l.xm)(e),m.default.success("Plant archived successfully"),fetchPlants()}catch(e){console.error("Error archiving plant:",e),m.default.error("Failed to archive plant")}};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Plant Inventory"}),(0,a.jsx)("button",{onClick:handleAddPlant,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add New Plant"})]}),r?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):e.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsx)(PlantCard,{plant:e,onEdit:handleEditPlant,onDelete:handleDeletePlant,onArchive:handleArchivePlant},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No plants in your inventory yet."}),(0,a.jsx)("button",{onClick:handleAddPlant,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add Your First Plant"})]})]})}},4034:function(e,t,r){"use strict";r.d(t,{YQ:function(){return addWateringRecords},xm:function(){return archivePlant},aE:function(){return createPlant},dr:function(){return deletePlant},JA:function(){return getPlant},sX:function(){return getPlants},WL:function(){return getWateringRecords},Vn:function(){return updatePlant}});var a=r(4566);let n=(0,a.eI)("https://xorjulfvnkcmsroavihv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhvcmp1bGZ2bmtjbXNyb2F2aWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMzMzMDQsImV4cCI6MjA1NzcwOTMwNH0.sxhrNSIfmbZXACOysArKUx2g8bUTees8tojRgKAmAp4");var s=r(3743),l=r(2536);async function compressImage(e){try{let t=await (0,l.Z)(e,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});return new File([t],e.name,{type:t.type})}catch(t){return console.error("Error compressing image:",t),e}}async function getPlants(){let{data:e,error:t}=await n.from("plants").select("*").eq("archived",!1).order("name");if(t)throw console.error("Error fetching plants:",t),t;let{data:r,error:a}=await n.from("watering_records").select("*");if(a)throw console.error("Error fetching watering records:",a),a;return e.map(e=>{let t=r.filter(t=>t.plant_id===e.id);if(0===t.length)return{...e,days_until_watering:0,last_watered:null};let a=t.reduce((e,t)=>new Date(e.date)>new Date(t.date)?e:t),n=new Date(a.date),l=(0,s.Z)(new Date,n),i=e.watering_frequency-l;return{...e,days_until_watering:i,last_watered:a.date}})}async function getPlant(e){let{data:t,error:r}=await n.from("plants").select("*").eq("id",e).single();if(r)throw console.error("Error fetching plant:",r),r;return t}async function createPlant(e,t){let r=null;if(t)try{let e=await compressImage(t),a=new Date().getTime(),s=t.name.split(".").pop(),l="".concat(a,"_").concat(Math.random().toString(36).substring(7),".").concat(s),{data:i,error:c}=await n.storage.from("plant-image").upload(l,e,{contentType:e.type});if(c)throw console.error("Error uploading image:",c),c;let{data:{publicUrl:o}}=n.storage.from("plant-image").getPublicUrl(l);r=o}catch(e){throw console.error("Error processing image upload:",e),e}let{data:a,error:s}=await n.from("plants").insert([{...e,image_url:r,archived:!1}]).select().single();if(s)throw console.error("Error creating plant:",s),s;return a}async function updatePlant(e,t,r){let a={...t};if(r)try{let e=await compressImage(r),s=new Date().getTime(),l=r.name.split(".").pop(),i="".concat(s,"_").concat(Math.random().toString(36).substring(7),".").concat(l);if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove([e])}let{data:c,error:o}=await n.storage.from("plant-image").upload(i,e,{contentType:e.type});if(o)throw console.error("Error uploading image:",o),o;let{data:{publicUrl:d}}=n.storage.from("plant-image").getPublicUrl(i);a.image_url=d}catch(e){throw console.error("Error processing image upload:",e),e}let{data:s,error:l}=await n.from("plants").update(a).eq("id",e).select().single();if(l)throw console.error("Error updating plant:",l),l;return s}async function archivePlant(e){let{error:t}=await n.from("plants").update({archived:!0}).eq("id",e);if(t)throw console.error("Error archiving plant:",t),t}async function deletePlant(e){let{data:t,error:r}=await n.from("plants").select("image_url").eq("id",e).single();if(r)throw console.error("Error fetching plant for deletion:",r),r;let{error:a}=await n.from("watering_records").delete().eq("plant_id",e);if(a)throw console.error("Error deleting watering records:",a),a;let{error:s}=await n.from("plants").delete().eq("id",e);if(s)throw console.error("Error deleting plant:",s),s;if(t.image_url){let e=t.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove(["plant-image/".concat(e)])}}async function getWateringRecords(e){let{data:t,error:r}=await n.from("watering_records").select("*").eq("plant_id",e).order("date",{ascending:!1});if(r)throw console.error("Error fetching watering records:",r),r;return t}async function addWateringRecords(e){let{error:t}=await n.from("watering_records").insert(e);if(t)throw console.error("Error adding watering records:",t),t}}},function(e){e.O(0,[332,433,971,472,744],function(){return e(e.s=6038)}),_N_E=e.O()}]);