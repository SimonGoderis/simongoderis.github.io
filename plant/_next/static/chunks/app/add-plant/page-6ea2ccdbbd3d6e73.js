(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[786],{8489:function(e,r,t){Promise.resolve().then(t.bind(t,576))},576:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return AddPlant}});var a=t(7437),n=t(4033),i=t(4034),l=t(7630),o=t(5925);function AddPlant(){let e=(0,n.useRouter)(),handleSubmit=async r=>{try{let t={name:r.get("name"),species:r.get("species"),watering_frequency:parseInt(r.get("watering_frequency")),sunlight_requirement:r.get("sunlight_requirement"),notes:r.get("notes"),date_acquired:new Date().toISOString(),image_url:null},a=r.get("image");await (0,i.aE)(t,a),o.default.success("Plant added successfully"),e.push("/")}catch(e){console.error("Error adding plant:",e),o.default.error("Failed to add plant")}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Add New Plant"})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,a.jsx)(l.Z,{onSubmit:handleSubmit,onCancel:()=>{e.push("/")}})})]})}},7630:function(e,r,t){"use strict";t.d(r,{Z:function(){return PlantForm}});var a=t(7437),n=t(2265),i=t(6691),l=t.n(i);function PlantForm(e){var r;let{plant:t,onSubmit:i,onCancel:o}=e,[s,d]=(0,n.useState)((null==t?void 0:t.name)||""),[c,u]=(0,n.useState)((null==t?void 0:t.species)||""),[m,g]=(0,n.useState)((null==t?void 0:null===(r=t.watering_frequency)||void 0===r?void 0:r.toString())||"7"),[f,p]=(0,n.useState)((null==t?void 0:t.sunlight_requirement)||"Medium"),[h,w]=(0,n.useState)((null==t?void 0:t.notes)||""),[x,b]=(0,n.useState)((null==t?void 0:t.image_url)||null),[v,y]=(0,n.useState)(null);return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=new FormData;r.append("name",s),r.append("species",c),r.append("watering_frequency",m),r.append("sunlight_requirement",f),r.append("notes",h),v&&r.append("image",v),(null==t?void 0:t.id)&&r.append("id",t.id),i(r)},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Plant Name *"}),(0,a.jsx)("input",{type:"text",id:"name",value:s,onChange:e=>d(e.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"species",className:"block text-sm font-medium text-gray-700",children:"Species"}),(0,a.jsx)("input",{type:"text",id:"species",value:c,onChange:e=>u(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"watering_frequency",className:"block text-sm font-medium text-gray-700",children:"Watering Frequency (days) *"}),(0,a.jsx)("input",{type:"number",id:"watering_frequency",value:m,onChange:e=>g(e.target.value),min:"1",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"sunlight_requirement",className:"block text-sm font-medium text-gray-700",children:"Sunlight Requirement"}),(0,a.jsxs)("select",{id:"sunlight_requirement",value:f,onChange:e=>p(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",children:[(0,a.jsx)("option",{value:"Low",children:"Low"}),(0,a.jsx)("option",{value:"Medium",children:"Medium"}),(0,a.jsx)("option",{value:"High",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,a.jsx)("textarea",{id:"notes",value:h,onChange:e=>w(e.target.value),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700",children:"Plant Image"}),(0,a.jsx)("input",{type:"file",id:"image",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let r=e.target.files[0];y(r);let t=new FileReader;t.onload=e=>{var r;b(null===(r=e.target)||void 0===r?void 0:r.result)},t.readAsDataURL(r)}},className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"})]}),x&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Image Preview:"}),(0,a.jsx)("div",{className:"relative h-48 w-full",children:(0,a.jsx)(l(),{src:x,alt:"Plant preview",fill:!0,className:"object-cover rounded-md"})})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:o,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700",children:t?"Update Plant":"Add Plant"})]})]})}},4034:function(e,r,t){"use strict";t.d(r,{YQ:function(){return addWateringRecords},xm:function(){return archivePlant},aE:function(){return createPlant},dr:function(){return deletePlant},JA:function(){return getPlant},sX:function(){return getPlants},WL:function(){return getWateringRecords},Vn:function(){return updatePlant}});var a=t(4566);let n=(0,a.eI)("https://xorjulfvnkcmsroavihv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhvcmp1bGZ2bmtjbXNyb2F2aWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxMzMzMDQsImV4cCI6MjA1NzcwOTMwNH0.sxhrNSIfmbZXACOysArKUx2g8bUTees8tojRgKAmAp4");var i=t(3743),l=t(2536);async function compressImage(e){try{let r=await (0,l.Z)(e,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});return new File([r],e.name,{type:r.type})}catch(r){return console.error("Error compressing image:",r),e}}async function getPlants(){let{data:e,error:r}=await n.from("plants").select("*").eq("archived",!1).order("name");if(r)throw console.error("Error fetching plants:",r),r;let{data:t,error:a}=await n.from("watering_records").select("*");if(a)throw console.error("Error fetching watering records:",a),a;return e.map(e=>{let r=t.filter(r=>r.plant_id===e.id);if(0===r.length)return{...e,days_until_watering:0,last_watered:null};let a=r.reduce((e,r)=>new Date(e.date)>new Date(r.date)?e:r),n=new Date(a.date),l=(0,i.Z)(new Date,n),o=e.watering_frequency-l;return{...e,days_until_watering:o,last_watered:a.date}})}async function getPlant(e){let{data:r,error:t}=await n.from("plants").select("*").eq("id",e).single();if(t)throw console.error("Error fetching plant:",t),t;return r}async function createPlant(e,r){let t=null;if(r)try{let e=await compressImage(r),a=new Date().getTime(),i=r.name.split(".").pop(),l="".concat(a,"_").concat(Math.random().toString(36).substring(7),".").concat(i),{data:o,error:s}=await n.storage.from("plant-image").upload(l,e,{contentType:e.type});if(s)throw console.error("Error uploading image:",s),s;let{data:{publicUrl:d}}=n.storage.from("plant-image").getPublicUrl(l);t=d}catch(e){throw console.error("Error processing image upload:",e),e}let{data:a,error:i}=await n.from("plants").insert([{...e,image_url:t,archived:!1}]).select().single();if(i)throw console.error("Error creating plant:",i),i;return a}async function updatePlant(e,r,t){let a={...r};if(t)try{let e=await compressImage(t),i=new Date().getTime(),l=t.name.split(".").pop(),o="".concat(i,"_").concat(Math.random().toString(36).substring(7),".").concat(l);if(r.image_url){let e=r.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove([e])}let{data:s,error:d}=await n.storage.from("plant-image").upload(o,e,{contentType:e.type});if(d)throw console.error("Error uploading image:",d),d;let{data:{publicUrl:c}}=n.storage.from("plant-image").getPublicUrl(o);a.image_url=c}catch(e){throw console.error("Error processing image upload:",e),e}let{data:i,error:l}=await n.from("plants").update(a).eq("id",e).select().single();if(l)throw console.error("Error updating plant:",l),l;return i}async function archivePlant(e){let{error:r}=await n.from("plants").update({archived:!0}).eq("id",e);if(r)throw console.error("Error archiving plant:",r),r}async function deletePlant(e){let{data:r,error:t}=await n.from("plants").select("image_url").eq("id",e).single();if(t)throw console.error("Error fetching plant for deletion:",t),t;let{error:a}=await n.from("watering_records").delete().eq("plant_id",e);if(a)throw console.error("Error deleting watering records:",a),a;let{error:i}=await n.from("plants").delete().eq("id",e);if(i)throw console.error("Error deleting plant:",i),i;if(r.image_url){let e=r.image_url.split("/").pop();e&&await n.storage.from("plant-image").remove(["plant-image/".concat(e)])}}async function getWateringRecords(e){let{data:r,error:t}=await n.from("watering_records").select("*").eq("plant_id",e).order("date",{ascending:!1});if(t)throw console.error("Error fetching watering records:",t),t;return r}async function addWateringRecords(e){let{error:r}=await n.from("watering_records").insert(e);if(r)throw console.error("Error adding watering records:",r),r}}},function(e){e.O(0,[332,971,472,744],function(){return e(e.s=8489)}),_N_E=e.O()}]);